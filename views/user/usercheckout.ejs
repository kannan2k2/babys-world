
<%-include('header') %>
<style>
  body{margin-top:20px;
background-color: #f1f3f7;
}

.card {
    margin-bottom: 24px;
    -webkit-box-shadow: 0 2px 3px #e4e8f0;
    box-shadow: 0 2px 3px #e4e8f0;
}
.card {
    position: relative;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -ms-flex-direction: column;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 1px solid #eff0f2;
    border-radius: 1rem;
}
.activity-checkout {
    list-style: none
}

.activity-checkout .checkout-icon {
    position: absolute;
    top: -4px;
    left: -24px
}

.activity-checkout .checkout-item {
    position: relative;
    padding-bottom: 24px;
    padding-left: 35px;
    border-left: 2px solid #f5f6f8
}

.activity-checkout .checkout-item:first-child {
    border-color: #3b76e1
}

.activity-checkout .checkout-item:first-child:after {
    background-color: #3b76e1
}

.activity-checkout .checkout-item:last-child {
    border-color: transparent
}

.activity-checkout .checkout-item.crypto-activity {
    margin-left: 50px
}

.activity-checkout .checkout-item .crypto-date {
    position: absolute;
    top: 3px;
    left: -65px
}



.avatar-xs {
    height: 1rem;
    width: 1rem
}

.avatar-sm {
    height: 2rem;
    width: 2rem
}

.avatar {
    height: 3rem;
    width: 3rem
}

.avatar-md {
    height: 4rem;
    width: 4rem
}

.avatar-lg {
    height: 5rem;
    width: 5rem
}

.avatar-xl {
    height: 6rem;
    width: 6rem
}

.avatar-title {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    background-color: #3b76e1;
    color: #fff;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    font-weight: 500;
    height: 100%;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    width: 100%
}

.avatar-group {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    padding-left: 8px
}

.avatar-group .avatar-group-item {
    margin-left: -8px;
    border: 2px solid #fff;
    border-radius: 50%;
    -webkit-transition: all .2s;
    transition: all .2s
}

.avatar-group .avatar-group-item:hover {
    position: relative;
    -webkit-transform: translateY(-2px);
    transform: translateY(-2px)
}

.card-radio {
    background-color: #fff;
    border: 2px solid #eff0f2;
    border-radius: .75rem;
    padding: .5rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: block
}

.card-radio:hover {
    cursor: pointer
}

.card-radio-label {
    display: block
}

.edit-btn {
    width: 35px;
    height: 35px;
    line-height: 40px;
    text-align: center;
    position: absolute;
    right: 25px;
    margin-top: -50px
}

.card-radio-input {
    display: none
}

.card-radio-input:checked+.card-radio {
    border-color: #3b76e1!important
}


.font-size-16 {
    font-size: 16px!important;
}
.text-truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

a {
    text-decoration: none!important;
}


.form-control {
    display: block;
    width: 100%;
    padding: 0.47rem 0.75rem;
    font-size: .875rem;
    font-weight: 400;
    line-height: 1.5;
    color: #545965;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #e2e5e8;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border-radius: 0.75rem;
    -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
}

.edit-btn {
    width: 35px;
    height: 35px;
    line-height: 40px;
    text-align: center;
    position: absolute;
    right: 25px;
    margin-top: -50px;
}

.ribbon {
    position: absolute;
    right: -26px;
    top: 20px;
    -webkit-transform: rotate(45deg);
    transform: rotate(45deg);
    color: #fff;
    font-size: 13px;
    font-weight: 500;
    padding: 1px 22px;
    font-size: 13px;
    font-weight: 500
}

.button {
      display: inline-block;
      padding: 5px 8px;
      font-size: 16px;
      text-align: center;
      text-decoration: none;
      border-radius: 3px;
      margin: 5px;
      transition: background-color 0.3s;
    }

    .edit-button {
      background-color: #b1b0b0; /* Green */
      color: white;
    }

    .edit-button:hover {
      background-color: #6c6c6c;
    }

    .delete-button {
      background-color: #b1b0b0; /* Red */
      color: white;
    }

    .delete-button:hover {
      background-color: #7a7a7a;
    }

</style>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Checkout Page</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css" integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous" />
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
      </head>
<body>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css" integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous" />
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  
  <div class="container">
  
      <div class="row" style="padding-top: 70px;">
          <div class="col-xl-8">
  
              <div class="card">
                  <div class="card-body">
                      <ol class="activity-checkout mb-0 px-4 mt-3">
                          <li class="checkout-item">
                              <div class="avatar checkout-icon p-1">
                                  <div class="avatar-title rounded-circle bg-primary">
                                      <i class="bx bxs-receipt text-white font-size-20"></i>
                                  </div>
                              </div>
                              <div class="feed-item-list">
                                  <div>
                                      <h5 class="font-size-16 mb-1">Billing Info</h5>
                                      <p class="text-muted text-truncate mb-4">Sed ut perspiciatis unde omnis iste</p>
                                      <div class="mb-3">
                                          <form action="/userCheckoutPost" method="post" >
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                  <label class="form-label" for="billing-name">Name</label>
                                                  <input type="text" class="form-control" id="billing-name" placeholder="Enter name" name="name">
                                                </div>
                                                <div class="col-md-6">
                                                  <label class="form-label" for="billing-phone">Phone</label>
                                                  <input type="text" class="form-control" id="billing-phone" placeholder="Enter Phone no." name="phone">
                                                </div>
                                              </div>
                                              <div class="mb-3">
                                                <label class="form-label" for="billing-address">Address</label>
                                                <textarea class="form-control" id="billing-address" rows="3" placeholder="Enter full address" name="address"></textarea>
                                              </div>
                                              <div class="row mb-3">
                                                <div class="col-md-4">
                                                  <label class="form-label" for="billing-state">State</label>
                                                  <input type="text" class="form-control" id="billing-state" placeholder="Enter State" name="state">
                                                </div>
                                                <div class="col-md-4">
                                                  <label class="form-label" for="billing-city">City</label>
                                                  <input type="text" class="form-control" id="billing-city" placeholder="Enter City" name="city">
                                                </div>
                                                <div class="col-md-4">
                                                  <label class="form-label" for="zip-code">Zip / Postal code</label>
                                                  <input type="text" class="form-control" id="zip-code" placeholder="Enter Postal code" name="zip">
                                                </div>
                                                 <div class="text-end">
                                                    <button class="btn btn-success" style="margin-top: 48px;">
                                                      <i class="mdi mdi-cart-outline me-1"></i> Save
                                                    </button>
                                                  </div>
                                             </form>
                                      </div>
                                  </div>
                              </div>
                          </li>
                          <li class="checkout-item">
                              <div class="avatar checkout-icon p-1">
                                  <div class="avatar-title rounded-circle bg-primary">
                                      <i class="bx bxs-truck text-white font-size-20"></i>
                                  </div>
                              </div>
                              <div class="feed-item-list">
                                  <div>
                                      <h5 class="font-size-16 mb-1">Shipping Info</h5>
                                      <p class="text-muted text-truncate mb-4">Neque porro quisquam est</p>
                                      <div class="mb-3">
                                          <div class="row">
                                            <% addresses.forEach((ele, i) => { %>
                                                <div class="col-lg-4 col-sm-6 mb-3">
                                                  <label class="card-radio-label">
                                                    <input type="radio" name="address" id="info-address<%= i + 1 %>" class="card-radio-input" <%= i === 0 ? 'checked' : '' %>>
                                                    <div class="card-radio text-truncate">
                                                      <span class="fs-14 mb-2 d-block"><%= ele.name %></span>
                                                      <span class="text-muted fw-normal text-wrap mb-1 d-block"><%= ele.address %></span>
                                                      <span class="text-muted fw-normal text-wrap mb-1 d-block"><%= ele.zip %></span>
                                                      <span class="text-muted fw-normal text-wrap mb-1 d-block"><%= ele.city %></span>
                                                      <span class="text-muted fw-normal text-wrap mb-1 d-block"><%= ele.state %></span>
                                                      <span class="text-muted fw-normal text-wrap d-block"><%= ele.phone %></span>
                                                      <span id="phone-info-address<%= i + 1 %>" class="text-muted fw-normal text-wrap d-block"><%= ele.phone %></span>

                                                      <div class="mt-2">
                                                        <a href="/editaddress/<%= ele._id %>/<%= i %>" class="button edit-button">Edit</a>
                                                        <a href="/deleteaddress/<%= ele._id %>" class="button delete-button">Delete</a>
                                                      </div>
                                                    </div>
                                                  </label>
                                                </div>
                                              <% }); %>
  
                                             
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </li>
                          <li class="checkout-item">
                              <div class="avatar checkout-icon p-1">
                                  <div class="avatar-title rounded-circle bg-primary">
                                      <i class="bx bxs-wallet-alt text-white font-size-20"></i>
                                  </div>
                              </div>
                              <div class="feed-item-list">
                                  <div>
                                      <h5 class="font-size-16 mb-1">Payment Info</h5>
                                      <p class="text-muted text-truncate mb-4">Duis arcu tortor, suscipit eget</p>
                                  </div>
                                  <div>
                                    <h5 class="font-size-14 mb-3">Payment method :</h5>
                                    <div class="row">
                                        <div class="col-lg-3 col-sm-6">
                                            <div data-bs-toggle="collapse">
                                                <label class="card-radio-label">
                                                    <input type="radio" name="pay-method" id="Razorpay" class="card-radio-input">
                                                    <span class="card-radio py-3 text-center text-truncate">
                                                        <i class="bx bx-credit-card d-block h2 mb-3"></i>
                                                        Razorpay / Debit Card
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="col-lg-3 col-sm-6">
                                            <div>
                                                <label class="card-radio-label">
                                                    <input type="radio" name="pay-method" id="Wallet" class="card-radio-input">
                                                    <span class="card-radio py-3 text-center text-truncate">
                                                        <i class="bx bxl-paypal d-block h2 mb-3"></i>
                                                        Wallet
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                
                                        <div class="col-lg-3 col-sm-6">
                                            <div>
                                                <label class="card-radio-label">
                                                    <input type="radio" name="pay-method" id="Cash-on-Delivery" class="card-radio-input" checked="">
                                                    <span class="card-radio py-3 text-center text-truncate">
                                                        <i class="bx bx-money d-block h2 mb-3"></i>
                                                        <span>Cash on Delivery</span>
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                
                              </div>
                          </li>
                      </ol>
                  </div>
              </div>
  
              <div class="row my-4">
                  <div class="col">
                      <a href="ecommerce-products.html" class="btn btn-link text-muted">
                          <i class="mdi mdi-arrow-left me-1"></i> Continue Shopping </a>
                  </div> <!-- end col -->
                  <!-- <div class="col">
                      <div class="text-end mt-2 mt-sm-0">
                          <a href="/ordersucess" class="btn btn-success">
                              <i class="mdi mdi-cart-outline me-1"></i> Procced </a>
                      </div>
                  </div> end col -->
              </div> <!-- end row-->
          </div>
          <div class="col-xl-4">
              <div class="card checkout-order-summary">
                <div class="card-body">
                    <div class="p-3 bg-light mb-3">
                      <h5 class="font-size-16 mb-0">Order Summary <span class="float-end ms-2">baby's world</span></h5>
                    </div>
                  
                    <!-- Coupon Section -->
                    <div class="mb-3">
                        <h5 class="font-size-16">Apply Coupon</h5>
                        <form id="couponForm">
                          <div class="input-group">
                            <select class="form-control" id="couponCode">
                              <option value="">Select a Coupon</option>
                              <% coupon.forEach(function(coupon) { %>
                                <option value="<%= coupon.couponCode %>"><%= coupon.couponCode %></option>
                              <% }); %>
                            </select>
                            <button class="btn btn-success" type="button" onclick="applyCoupon()">Apply</button>
                          </div>
                        </form>
                        <div id="couponMessage" class="mt-2"></div>
                      </div>
                    <!-- End Coupon Section -->
                  
                    <div class="table-responsive">
                      <table class="table table-centered mb-0 table-nowrap">
                        <thead>
                          <tr>
                            <th class="border-top-0" style="width: 110px;" scope="col">Product</th>
                            <th class="border-top-0" scope="col">Product Desc</th>
                            <th class="border-top-0" scope="col">Price</th>
                          </tr>
                        </thead>
                        <% cart.forEach((ele, i) => { %>
                        <tbody>
                          <tr>
                            <th scope="row">
                              <img src="/uploads/<%= ele.Product.image[0] %>" alt="product-img" title="product-img" class="avatar-lg rounded">
                            </th>
                            <td>
                              <h5 class="font-size-16 text-truncate">
                                <a href="#" class="text-dark"><%= ele.Product.ProductName %></a>
                              </h5>
                              <p class="text-muted mb-0">
                                <i class="bx bxs-star text-warning"></i>
                                <i class="bx bxs-star text-warning"></i>
                                <i class="bx bxs-star text-warning"></i>
                                <i class="bx bxs-star text-warning"></i>
                              </p>
                              <p class="text-muted mb-0"><%= ele.Product.price %></p>
                              <p class="text-muted mb-0 mt-1">Quantity: <%= ele.quantity %></p>
                            </td>
                            <td><%= ele.totalPrice %></td>
                           
                          </tr>
                        </tbody>
                        <% }); %>
                        <tr class="bg-light">
                          <td colspan="2">
                            <h5 class="font-size-14 m-0">DiscountAmount:</h5>
                          </td>
                          <td id="discountAmount"></td>
                          <input type="hidden" id="discountAmount" >
                        </tr>
                        <tr class="bg-light">
                          <td colspan="2">
                            <h5 class="font-size-14 m-0">Total:</h5>
                          </td>
                          <td id="totalPrice"><%= overallTotalPrice %></td>
                          <input type="hidden" id="overallTotalPrice" value="<%= overallTotalPrice %>">
                        </tr>
                      </table>
                  
                      <div class="text-end">
                        <button class="btn btn-success" id="proceed" style="margin-top: 48px;">
                          <i class="mdi mdi-cart-outline me-1"></i> Proceed
                        </button>
                      </div>
                    </div>
                  </div>
                  
              </div>
          </div>
      </div>
      <!-- end row -->
     
  </div>  
  <%-include('footer')  %>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>

document.addEventListener('DOMContentLoaded', () => {
    const proceedButton = document.getElementById('proceed'); //  Proceed button

    proceedButton.addEventListener('click', async () => {
        // Retrieve selected address details
        const selectedAddressRadio = document.querySelector('input[name="address"]:checked');
        
        if (!selectedAddressRadio) {
            alert('Please select an address.');
            return;
        }
       const selectedAddressId = selectedAddressRadio.id.replace('info-address', '');
        const selectedAddressName = selectedAddressRadio.nextElementSibling.querySelector('.fs-14').textContent.trim();
        const textWrapElements = selectedAddressRadio.nextElementSibling.querySelectorAll('.text-wrap');
        const selectedAddressAddress = textWrapElements[0].textContent.trim(); // Address
        const selectedAddressZip = textWrapElements[1].textContent.trim(); // Zip
        const selectedAddressCity = textWrapElements[2].textContent.trim(); // City
        const selectedAddressState = textWrapElements[3].textContent.trim(); // State
        const selectedAddressPhone = document.getElementById(`phone-info-address${selectedAddressId}`).textContent.trim();
        const totalprice = document.getElementById('totalPrice').textContent;


// Example: Log selected address details
console.log('Selected Address ID:', selectedAddressId);
console.log('Selected Address Name:', selectedAddressName);
console.log('Selected Address Address:', selectedAddressAddress);
console.log('Selected Address Zip:', selectedAddressZip);
console.log('Selected Address City:', selectedAddressCity);
console.log('Selected Address State:', selectedAddressState);
console.log('Selected Address Phone:', selectedAddressPhone);


   

        // Retrieve selected payment methodinput
         const paymentMethod = document.querySelector('[name="pay-method"]:checked').id.replace('pay-methodoption', '');
    if (paymentMethod === 'Cash-on-Delivery' && parseInt(totalprice) > 1000) {
      Swal.fire({
        icon: 'error',
        title: 'Invalid Payment Method',
        text: 'Cash on Delivery is not allowed for orders above ₹1000.',
      });
      return;
    }
        //  const paymentMethodElement = document.querySelector('[name="pay-method"]:checked');
        // const paymentMethodName = paymentMethodElement.getAttribute('name');

        // console.log('Payment Method Name:', paymentMethodName);
        // // Prepare data to send

    

        const formData = {
           
            addressId: selectedAddressId,
            addressName: selectedAddressName,
            addressAddress: selectedAddressAddress,
            addressZip: selectedAddressZip, 
            addressCity:selectedAddressCity,
            addressState:selectedAddressState,
            addressPhone: selectedAddressPhone,
           
            paymentMethod:paymentMethod
            // Add other necessary data here
        };
     

        if(paymentMethod== 'Cash-on-Delivery'){


          try {
            const response = await fetch('/sucessOrderRuntime', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            console.log('Success:', data);
            window.location.href = '/ordersuccess';
            // Redirect or handle success as needed
        } catch (error) {
            console.error('Error:', error);
            // Handle error condition
        }   

        }
        else if (paymentMethod == 'Wallet') {
        
  if (parseInt(totalprice) >parseInt('<%= walletAmount%>') ) {
    // alert('Insufficient wallet balance. Please add funds to your wallet.');
    Swal.fire({
      icon: 'error',
      title: 'Insufficient Wallet Balance',
      text: 'Please add funds to your wallet.'
    });
  } else {
    // Wallet payment handling logic           
   
      try {
        const response = await fetch('/sucessOrderRuntime', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          console.log(response)
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        console.log('Success:', data);
        window.location.href = '/ordersuccess';
      } catch (error) {
        console.error('Error:', error);
      }
    
  }



            
        }else if(paymentMethod== 'Razorpay'){

            

            fetch('/createOrder',{
               method: 'POST',
              headers: {
                         'Content-Type':'application/json',
                          },
               body: JSON.stringify({ amount:totalprice, currency: 'INR' }), // Adjust amount and currency as needed
     })
    .then(response => response.json())
    .then(data => {
      const options = {
        key: 'rzp_test_JkT3o5VYOxKgH3', // Replace with your Razorpay key
        amount: data.amount,
        currency: 'INR',
        name: 'Babys world',
        description: 'Test Transaction',
        image: 'https://example.com/your_logo',
        order_id: data.orderId, 
        handler: function (response) {
          // Handle successful payment
            // Payment successful
            console.log('Payment successful! Payment ID:', response.razorpay_payment_id);
            window.location.href = '/ordersuccess';

           
          try {
            const response = fetch('/sucessOrderRuntime', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = response.json();
            console.log('Success:', data);
            window.location.href = '/ordersuccess';
         
        } catch (error) {
            console.error('Error:', error);
       
        }   
        
        },
        prefill: {
          name: 'suryadarsh',
          email: 'suryadarsh@example.com',
          contact: '1000090000',
        },
        notes: {
          address: 'Razorpay Corporate Office',
        },
        theme: {
          color: '#3399cc',
        },
      };

      const rzp = new Razorpay(options);

      rzp.open();


      rzp.on('payment.failed', function (response)  {
             console.log('Payment failed:', response.error.description);

            // Send failure data to server
            fetch('/paymentFailure', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Failure notification sent:', data);
                // Notify user or redirect to an error page 
                window.location.href ='/paymentFailedPage'; // Redirect on failure
            })
            .catch(error => {
                console.error('Error sending failure notification:', error);
            });
        });

    })
    .catch(error => {
        console.error('Error:', error);
    });
}
       
    });
});

function applyCoupon() {
    var couponCode = document.getElementById('couponCode').value;
    if (couponCode) {
      //  apply the coupon
      // Update the message div with the result
      document.getElementById('couponMessage').innerText = 'Coupon applied: ' + couponCode;
    } else {
      document.getElementById('couponMessage').innerText = 'Please select a coupon';
    }
  }

//   ---------------------------------------------------------------
// coupon
async function applyCoupon() {
  const couponCode = document.getElementById('couponCode').value;
  const couponMessage = document.getElementById('couponMessage');

  if (!couponCode) {
    couponMessage.textContent = 'Please select a coupon.';
    couponMessage.classList.add('text-danger');
    return;
  }

  try {
    const response = await fetch('/applyCoupon', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ couponCode })
    });

    const result = await response.json();

    if (response.ok) {
      couponMessage.textContent = result.message;
      couponMessage.classList.remove('text-danger');
      couponMessage.classList.add('text-success');
      // Optionally, update the total price displayed on the UI
      document.getElementById('totalPrice').textContent = result.cartData.totalPrice;
      document.getElementById('discountAmount').textContent = result.discountAmount;
    } else {
      couponMessage.textContent = result.message;
      couponMessage.classList.remove('text-success');
      couponMessage.classList.add('text-danger');
    }
  } catch (error) {
    couponMessage.textContent = 'An error occurred while applying the coupon. Please try again.';
    couponMessage.classList.remove('text-success');
    couponMessage.classList.add('text-danger');
  }
}

  </script>
</body>
</html>


